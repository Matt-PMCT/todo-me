{#
  Project Tree Component

  Variables:
  - projects: array - The tree of projects from the API
  - selectedProjectId: string|null - Currently selected project ID
  - showArchived: bool - Whether to show archived projects
#}
<div x-data="projectTree({
    projects: {{ projects|json_encode|raw }},
    selectedProjectId: '{{ selectedProjectId ?? '' }}',
    showArchived: {{ showArchived|default(false) ? 'true' : 'false' }},
    apiBaseUrl: '{{ path('api_projects_tree') }}'
})"
class="project-tree">

    {# Tree Header #}
    <div class="flex items-center justify-between px-3 py-2">
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Projects</h3>
        <div class="flex items-center gap-1">
            <button @click="refreshTree()"
                    class="min-h-11 min-w-11 sm:min-h-0 sm:min-w-0 p-1 text-gray-400 hover:text-gray-600 rounded transition-colors flex items-center justify-center"
                    title="Refresh projects">
                <span class="sr-only">Refresh projects</span>
                <svg class="w-4 h-4" :class="{ 'animate-spin': loading }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
            <button @click="$dispatch('open-project-create-modal')"
                    type="button"
                    class="min-h-11 min-w-11 sm:min-h-0 sm:min-w-0 p-1 text-gray-400 hover:text-indigo-600 rounded transition-colors flex items-center justify-center"
                    title="New project">
                <span class="sr-only">New project</span>
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>
        </div>
    </div>

    {# All Tasks Link #}
    <a href="{{ path('app_task_list') }}"
       class="min-h-11 sm:min-h-0 flex items-center gap-2 px-3 py-2 text-sm rounded-md mx-2 mb-1
              {{ app.request.attributes.get('_route') == 'app_task_list' and not selectedProjectId ? 'bg-indigo-50 text-indigo-700 font-medium' : 'text-gray-700 hover:bg-gray-50' }}">
        <svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
        <span>All Tasks</span>
    </a>

    {# Project Tree #}
    <div class="mt-1">
        <template x-if="tree.length === 0 && !loading">
            <p class="px-3 py-4 text-sm text-gray-500 text-center">
                No projects yet
            </p>
        </template>

        <template x-for="project in tree" :key="project.id">
            <div>
                {% include 'components/project-tree-node.html.twig' with { depth: 0 } %}
            </div>
        </template>
    </div>

    {# Archived Projects Link #}
    <div class="mt-4 pt-4 border-t border-gray-200 mx-2">
        <a href="{{ path('app_projects_archived') }}"
           class="min-h-11 sm:min-h-0 flex items-center gap-2 px-3 py-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-md">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
            </svg>
            <span>Archived</span>
        </a>
    </div>
</div>
