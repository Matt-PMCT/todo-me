{# Sort dropdown component #}
{# Expects: currentSort (string), currentDirection (string, 'ASC' or 'DESC') #}

{% set currentSort = currentSort|default('position') %}
{% set currentDirection = currentDirection|default('ASC') %}

<div class="relative" x-data="{ open: false }">
    <button @click="open = !open" type="button" class="min-h-11 sm:min-h-0 inline-flex items-center gap-2 rounded-md bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path>
        </svg>
        Sort by: {{ currentSort|replace({'_': ' '})|capitalize }}
        {% if currentDirection == 'DESC' %}(Desc){% endif %}
    </button>

    <div x-show="open"
         x-cloak
         @click.away="open = false"
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="transform opacity-0 scale-95"
         x-transition:enter-end="transform opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="transform opacity-100 scale-100"
         x-transition:leave-end="transform opacity-0 scale-95"
         class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">

        {% set sortOptions = {
            'position': 'Position',
            'due_date': 'Due Date',
            'priority': 'Priority',
            'created_at': 'Created',
            'updated_at': 'Updated',
            'title': 'Title'
        } %}

        {% for value, label in sortOptions %}
            {% set isActive = currentSort == value %}
            {% set newDirection = (isActive and currentDirection == 'ASC') ? 'DESC' : 'ASC' %}
            {% set params = app.request.query.all|merge({'sort': value, 'direction': newDirection}) %}

            <a href="{{ path(app.request.attributes.get('_route'), params) }}"
               class="block px-4 py-2 text-sm {% if isActive %}bg-gray-100 text-indigo-600{% else %}text-gray-700 hover:bg-gray-50{% endif %}">
                {{ label }}
                {% if isActive %}
                    <span class="float-right">
                        {% if currentDirection == 'ASC' %}
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                            </svg>
                        {% else %}
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        {% endif %}
                    </span>
                {% endif %}
            </a>
        {% endfor %}
    </div>
</div>
